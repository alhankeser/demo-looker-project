name: Looker Janitor
on:
    pull_request:
        types:  [opened, synchronize]

jobs:
    run-looker-janitor:
        permissions:
            contents: write
        runs-on: ubuntu-latest
        steps:
            - name: Run Looker Janitor
              id: looker_janitor
              uses: alhankeser/looker-janitor-action@dev
              with:
                check_required_params: true
                required_dimension: |
                  hidden
                  type
                required_measure: |
                  value_format_name
            - name: Get Changed Files
              id: changed_files
              uses: tj-actions/changed-files@v44
              with:
                files: |
                    **.view.lkml
                    **.view.lookml
            - name: Commit Cleaned Files
              id: commit_changes
              run: |
                for file in ${{ steps.changed_files.outputs.all_changed_files }}; do
                    git add "${file}"
                done
                git commit -m "Run Looker Janitor" || continue
                git push
              shell: bash
            - name: Test
              shell: bash
              run: |
                cat looker-janitor/output.txt
                echo "'customers.view.lkml:24: measure '"'"'avg_customer_age'"'"' missing value_format_name" > looker-janitor/output.txt
                echo "hello" > random.txt
                cat random.txt
                cat looker-janitor/output.txt
            # - name: Setup Review Dog
            #   uses: reviewdog/action-setup@v1
            # - name: Run Review Dog
            #   env:
            #     REVIEWDOG_GITHUB_API_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            #   run: |
            #     cat looker-janitor/output.txt | reviewdog -efm="%f:%l: %m"
            
